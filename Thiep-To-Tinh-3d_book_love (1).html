<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chuyện Tình Yêu</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Pacifico&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
<style>
    body { margin: 0; padding: 0; overflow: hidden; font-family: 'Nunito', sans-serif; background-color: #ffe6e6; display: flex; justify-content: center; align-items: center; height: 100vh; perspective: 1500px; }
    #bg-canvas, #fireworks-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    #fireworks-canvas { z-index: 100; pointer-events: none; display: none; }
    #bg-canvas { z-index: 0; }
    #music-control { position: absolute; top: 20px; right: 20px; z-index: 20; background: rgba(255,255,255,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    
    /* FIX: Kích thước sách Responsive */
    .book { 
        position: relative; 
        /* Sử dụng clamp: Min 300px, Max 350px, ưu tiên 70% viewport */
        width: clamp(300px, 70vw, 350px); 
        height: clamp(450px, 90vh, 500px); 
        transform-style: preserve-3d; transition: transform 1s; z-index: 10; 
    }
    .page { position: absolute; width: 100%; height: 100%; top: 0; left: 0; transform-origin: left; transform-style: preserve-3d; transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1); border-radius: 0 10px 10px 0; box-shadow: inset 0 0 30px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.1); background: white; }
    .front, .back { position: absolute; width: 100%; height: 100%; top: 0; left: 0; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center; box-sizing: border-box; }
    .front { background-color: #fff; z-index: 2; }
    .back { background-color: #fdfdfd; transform: rotateY(180deg); z-index: 1; }
    .cover-front { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: white; border: 2px solid #ff758c; cursor: pointer; }
    .heart-logo { font-size: 80px; color: #ff3366; filter: drop-shadow(0 5px 15px rgba(255, 51, 102, 0.4)); transition: transform 0.3s; }
    .heart-wrapper { animation: spin3D 10s linear infinite; transform-style: preserve-3d; }
    .heart-icon { animation: beatOnly 1s infinite alternate; }
    @keyframes spin3D { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
    @keyframes beatOnly { 0% { transform: scale(1); } 100% { transform: scale(1.15); } }
    h1 { font-family: 'Pacifico', cursive; color: #ff4d6d; }
    /* FIX: Tiêu đề H2 và P sẽ nhỏ hơn trên mobile */
    h2 { font-family: 'Pacifico', cursive; color: #ff4d6d; font-size: 1.8rem; }
    p { font-family: 'Dancing Script', cursive; font-size: 1.2rem; color: #555; line-height: 1.5; }
    .memory-img { 
        width: 80%; 
        /* FIX: Chiều cao ảnh linh hoạt hơn */
        height: clamp(150px, 30vh, 180px); 
        object-fit: cover; border-radius: 10px; border: 3px solid #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.15); margin-bottom: 15px; transform: rotate(-2deg); transition: 0.3s; 
    }
    .memory-img:hover { transform: rotate(0deg) scale(1.05); }
    .btn-next { margin-top: 10px; padding: 8px 20px; background: #ff4d6d; color: white; border: none; border-radius: 20px; cursor: pointer; }
    #p1 { z-index: 5; } #p2 { z-index: 4; } #p3 { z-index: 3; } #p4 { z-index: 2; }
    .flipped { transform: rotateY(-180deg); }
    #final-message { 
        position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; 
        display: flex; justify-content: center; align-items: center; flex-direction: column; 
        opacity: 0; pointer-events: none; transition: opacity 2s; z-index: 50; 
        background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(3px); 
    }
    #final-message.visible { opacity: 1; pointer-events: auto; }
    .final-text { 
        font-family: 'Pacifico', cursive; font-size: 4.5rem; color: #ffffff; 
        text-shadow: 0 0 10px #ff0055, 0 0 20px #ff0055, 0 0 40px #ff0055, 0 0 80px #ff0055; 
        animation: glow 2s ease-in-out infinite alternate; text-align: center; line-height: 1.2;
    }
    .final-sub { color: #ffd1dc; font-size: 1.5rem; margin-top: 20px; font-style: italic; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    @keyframes glow { from { opacity: 0.9; transform: scale(1); } to { opacity: 1; transform: scale(1.05); } }
    
    /* FIX: Điều chỉnh cỡ chữ cho màn hình nhỏ hơn 768px */
    @media (max-width: 768px) { 
        .book { 
            width: 85vw !important; /* Dùng 85% chiều rộng màn hình */
            height: 90vh !important; /* Dùng 90% chiều cao màn hình */
        }
        .page .front, .page .back {
            padding: 15px; /* Giảm padding */
        }
        h2 { font-size: 1.5rem; }
        p { font-size: 1.1rem; }
        .memory-img { height: 150px; }
        .final-text { font-size: 2.5rem; }
        .final-sub { font-size: 1.2rem; }
    }
</style>
</head>
<body>
    <div id="music-control" onclick="toggleMusic()"><i id="music-icon" class="fas fa-volume-off"></i></div>
    <canvas id="bg-canvas"></canvas>
    <canvas id="fireworks-canvas"></canvas>
    <div id="final-message">
        <h1 class="final-text">Anh Yêu Em Nhiều Lắm ❤️</h1>
        <p class="final-sub">(Happy Ending)</p>
    </div>
    <div class="book" id="book">
        <div class="page" id="p1">
            <div class="front cover-front" onclick="nextPage(1)">
                <div class="heart-wrapper"><i class="fas fa-heart heart-icon heart-logo"></i></div>
                <h1 class="text-3xl mt-5 text-white">Chuyện Tình Yêu</h1>
                <p class="text-white mt-2">Nhấn để mở sách</p>
            </div>
            <div class="back">
                <h2>Gặp Gỡ</h2>
                <img src="https://placehold.co/400x300/pink/white?text=Anh+1" class="memory-img">
                <p>"Lần đầu tiên nhìn thấy em, anh biết trái tim mình đã lỡ nhịp..."</p>
                <button class="btn-next" onclick="nextPage(2)">Tiếp <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        <div class="page" id="p2">
            <div class="front">
                <h2>Rung Động</h2>
                <img src="https://placehold.co/400x300/pink/white?text=Anh+2" class="memory-img">
                <p>"Những tin nhắn thâu đêm, anh nhận ra mình đã thích em..."</p>
                <button class="btn-next" onclick="prevPage(2)">Quay lại</button>
            </div>
            <div class="back">
                <h2>Hẹn Hò</h2>
                <img src="https://placehold.co/400x300/pink/white?text=Anh+3" class="memory-img">
                <p>"Cái nắm tay đầu tiên, thế giới thu bé lại vừa bằng một người."</p>
                <button class="btn-next" onclick="nextPage(3)">Tiếp <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        <div class="page" id="p3">
            <div class="front">
                <h2>Kỷ Niệm</h2>
                <img src="https://placehold.co/400x300/pink/white?text=Anh+4" class="memory-img">
                <p>"Có những lúc vui buồn, nhưng ta vẫn luôn bên nhau."</p>
                <button class="btn-next" onclick="prevPage(3)">Quay lại</button>
            </div>
            <div class="back">
                <h2>Tương Lai</h2>
                <img src="https://placehold.co/400x300/pink/white?text=Anh+5" class="memory-img">
                <p>"Anh muốn cùng em đi tiếp chặng đường dài phía trước..."</p>
                <button class="btn-next" onclick="closeBook()">Đồng ý <i class="fas fa-check"></i></button>
            </div>
        </div>
        <div class="page" id="p4"><div class="front"><h2 class="mt-20 text-pink-500">Mãi Mãi</h2><div class="text-6xl text-pink-400 my-5"><i class="fas fa-infinity"></i></div></div><div class="back cover-back"></div></div>
    </div>
    <!-- Audio element placeholder -->
    
    <script>
        /* Logic điều khiển nhạc */
        
                        let isPlaying = false; let synth; const icon = document.getElementById('music-icon');
                        window.toggleMusic = function() {
                            if(!synth) {
                                synth=new Tone.PluckSynth({volume:-15}).toDestination(); 
                                let notes=["C4","E4","G4","A4","G4","E4"]; let i=0; 
                                new Tone.Loop(t=>{synth.triggerAttackRelease(notes[i%6],"8n",t,0.5);i++},"0.5").start(0); 
                                Tone.Transport.bpm.value=80;
                            }
                            if(Tone.context.state!=='running') Tone.start();
                            if(isPlaying){Tone.Transport.pause();icon.className="fas fa-volume-off"}
                            else{Tone.Transport.start();icon.className="fas fa-volume-up"}
                            isPlaying=!isPlaying;
                        }
                    
        
        /* Logic sách */
        let book=document.getElementById('book');
        function nextPage(i){ if(i===1) toggleMusic(); document.getElementById('p'+i).classList.add('flipped'); document.getElementById('p'+i).style.zIndex=i; if(i===1) book.style.transform="translateX(50%)"; }
        function prevPage(i){ let p=document.getElementById('p'+(i-1)); p.classList.remove('flipped'); setTimeout(()=>p.style.zIndex=10-(i-1)+1,500); if(i-1===1) book.style.transform="translateX(0%)"; }
        function closeBook(){ document.getElementById('p3').classList.add('flipped'); setTimeout(()=>{book.style.transform="translateX(0%) rotateY(0deg)"; document.getElementById('final-message').classList.add('visible'); document.getElementById('fireworks-canvas').style.display='block'; startFireworks(); setTimeout(()=>{book.style.opacity='0';book.style.pointerEvents='none'},500)},1000); }
        
        /* Decoration Scripts (Heart Rain) */
        const bgCanvas=document.getElementById('bg-canvas'), bgCtx=bgCanvas.getContext('2d'); let hearts=[]; function resizeBg(){bgCanvas.width=window.innerWidth;bgCanvas.height=window.innerHeight} window.addEventListener('resize',resizeBg); resizeBg();
        class HeartDrop{ constructor(){this.reset();this.y=Math.random()*bgCanvas.height} reset(){this.x=Math.random()*bgCanvas.width;this.y=-20;this.size=Math.random()*15+5;this.speed=Math.random()*2+1;this.color=`rgba(255,${Math.random()*100+100},${Math.random()*100+150},0.5)`} update(){this.y+=this.speed;if(this.y>bgCanvas.height)this.reset()} draw(){bgCtx.fillStyle=this.color;bgCtx.beginPath();bgCtx.arc(this.x,this.y,this.size/2,0,Math.PI*2);bgCtx.fill()} }
        for(let i=0;i<50;i++) hearts.push(new HeartDrop()); function animateBg(){bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height);hearts.forEach(h=>{h.update();h.draw()});requestAnimationFrame(animateBg)} animateBg();
        
        /* UPDATED: Logic Pháo Hoa Đẹp Hơn (Tròn, Rơi, Nhiều Màu) */
        const fwCanvas=document.getElementById('fireworks-canvas'), fwCtx=fwCanvas.getContext('2d'); 
        let particles=[];
        function resizeFw(){ fwCanvas.width=window.innerWidth;fwCanvas.height=window.innerHeight} window.addEventListener('resize',resizeFw); resizeFw();

        function createFirework(x,y){
            const colors = ['#ff0055', '#ffcc00', '#ffffff', '#ff66b2']; // Hồng đậm, Vàng gold, Trắng
            const count = 80; // Nhiều hạt hơn
            for(let i=0;i<count;i++){
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 4 + 2; // Tốc độ nổ
                particles.push({
                    x: x, y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    alpha: 1,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    decay: Math.random() * 0.015 + 0.005,
                    gravity: 0.05 
                })
            }
        }
        function startFireworks(){ 
            function loop(){ 
                fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height); 
                
                particles.forEach((p,i)=>{
                    p.x+=p.vx;
                    p.y+=p.vy;
                    p.vy += p.gravity; // Có trọng lực rơi xuống
                    p.vx *= 0.96; // Ma sát không khí
                    p.vy *= 0.96;
                    p.alpha-=p.decay; 
                    
                    fwCtx.globalAlpha=p.alpha; 
                    fwCtx.fillStyle=p.color; 
                    fwCtx.beginPath(); 
                    fwCtx.arc(p.x,p.y,2.5,0,Math.PI*2); // Hạt to hơn chút
                    fwCtx.fill(); 
                    
                    if(p.alpha<=0)particles.splice(i,1)
                }); 
                
                // Bắn ngẫu nhiên
                if(Math.random()<0.04) createFirework(Math.random()*fwCanvas.width, Math.random()*fwCanvas.height*0.6); 
                
                requestAnimationFrame(loop) 
            } 
            createFirework(fwCanvas.width/2, fwCanvas.height/3); // Bắn phát mở màn
            loop(); 
        }
    </script>
</body>
</html>